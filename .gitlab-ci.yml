variables:
  GIT_DEPTH: 1

before_script:
    - apt-get update -qq && apt-get install -yqq python3-pip python3-dev
    - pip3 install -U sphinx
    - pip3 install -U sphinx_rtd_theme sphinx-tabs
    - git config --global user.email "krishna.vijay4444@gmail.com"
    - git config --global user.name Krishna
    - make -C docs html

ghpages:
  stage: deploy
  script:
    - cd docs
    - git clone --depth 1 $GH/krishvk.github.io.git ghpages
    - rm -rf ghpages/*
    - cp -rf build/html/* ghpages
    - cp -rf ../html ghpages
    - cd ghpages
    - grep -rl 'UA-36650734' . | xargs sed -i 's/UA-36650734-[[:digit:]]/UA-36650734-4/g'
    - touch .nojekyll
    - git add .
    - git diff-index --quiet HEAD || git commit -m 'Mirror docs' .
    - git push $GH/krishvk.github.io.git

pages:
  stage: deploy
  script:
    - cd docs
    - cp -rf build/html ../public
    - cp -rf ../html ../public/dhtml
  artifacts:
    paths:
    - public
  only:
  - master
